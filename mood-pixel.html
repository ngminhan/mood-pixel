<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mood Tracker ‚Äî Click to Choose</title>
  <style>
    :root{
      --cell-size: 28px;
      --border: #ddd;
      --font: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    body{
      font-family: var(--font);
      margin: 18px;
      color: #222;
      display:flex;
      flex-direction:column;
      gap:16px;
      align-items:center;
    }
    h1{ margin:0; font-size:20px; text-align:center; }

    .board-wrap{
      overflow:auto;
      width:100%;
      border:1px solid var(--border);
      padding:10px;
      border-radius:8px;
      background: #fff;
    }

    table {
      border-collapse:collapse;
      font-size:12px;
    }
    thead th{
      position:sticky;
      top:0;
      background:#fff;
      z-index:2;
      border-bottom:1px solid var(--border);
      padding:6px;
    }
    tbody th{
      text-align:left;
      padding:6px 8px;
      font-weight:600;
      border-right:1px solid var(--border);
      background:#fafafa;
      position: sticky;
      left:0;
      z-index:1;
    }
    td{
      width: var(--cell-size);
      height: var(--cell-size);
      text-align:center;
      border:1px solid var(--border);
      cursor:pointer;
      transition: background 0.15s;
    }
    td.inactive{
      background:#f8f8f8;
      color:#bbb;
      cursor:not-allowed;
    }

    /* Mood colors */
    .happy{ background:#e99696 !important; }
    .excited{ background:#e99696 !important; }
    .calm{ background:#bcba8a !important; }
    .sad{ background:#a0c983 !important; }
    .stressed{ background:#7dd77c !important; }

    /* Mood selector popup */
    .popup{
      position:absolute;
      display:none;
      background:#fff;
      border:1px solid #ccc;
      border-radius:8px;
      padding:6px;
      box-shadow:0 2px 6px rgba(0,0,0,0.15);
      z-index:1000;
    }
    .popup button{
      border:none;
      margin:3px;
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
      color:#fff;
    }
    .popup .happy{ background:#e99696; }
    .popup .excited{ background:#e99696; }
    .popup .calm{ background:#bcba8a; color:#000; }
    .popup .sad{ background:#a0c983; color:#000; }
    .popup .stressed{ background:#7dd77c; color:#000; }
  </style>
</head>
<body>
  <h1>Mood Tracker ‚Äî Click ƒë·ªÉ ch·ªçn mood</h1>

  <div class="board-wrap">
    <table id="moodTable">
      <thead>
        <tr>
          <th></th>
          <!-- Days 1..31 -->
        </tr>
      </thead>
      <tbody>
        <!-- Months rows -->
      </tbody>
    </table>
  </div>

  <div id="popup" class="popup">
    <button class="happy" data-mood="happy">üòÉ</button>
    <button class="excited" data-mood="excited">ü§©</button>
    <button class="calm" data-mood="calm">üòå</button>
    <button class="sad" data-mood="sad">üò¢</button>
    <button class="stressed" data-mood="stressed">üò´</button>
  </div>

  <script>
    const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    const storageKey = "moodGrid_v2";

    const table = document.getElementById("moodTable");
    const theadRow = table.querySelector("thead tr");
    const tbody = table.querySelector("tbody");
    const popup = document.getElementById("popup");

    // Header 1..31
    for(let d=1; d<=31; d++){
      const th = document.createElement("th");
      th.textContent = d;
      theadRow.appendChild(th);
    }

    // Days in month
    const year = new Date().getFullYear();
    function daysInMonth(m){ return new Date(year, m+1, 0).getDate(); }

    // Build rows
    for(let m=0;m<12;m++){
      const tr = document.createElement("tr");
      const th = document.createElement("th");
      th.textContent = monthNames[m];
      tr.appendChild(th);
      for(let d=1;d<=31;d++){
        const td = document.createElement("td");
        td.dataset.month = m+1;
        td.dataset.day = d;
        td.id = `cell-${m+1}-${d}`;
        if(d>daysInMonth(m)){ td.classList.add("inactive"); }
        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    }

    // Load + render
    function loadGrid(){
      try{ return JSON.parse(localStorage.getItem(storageKey))||{} }catch(e){ return {}; }
    }
    function saveGrid(g){ localStorage.setItem(storageKey, JSON.stringify(g)); }
    function renderGrid(){
      const g=loadGrid();
      Object.keys(g).forEach(k=>{
        const [m,d]=k.split("-"); const cell=document.getElementById(`cell-${m}-${d}`);
        if(cell){ cell.className=""; cell.classList.add(g[k]); }
      });
    }

    // Show popup
    let currentCell=null;
    table.addEventListener("click",(e)=>{
      if(e.target.tagName!=="TD") return;
      const td=e.target;
      if(td.classList.contains("inactive")) return;
      currentCell=td;
      const rect=td.getBoundingClientRect();
      popup.style.left=(rect.left+window.scrollX)+"px";
      popup.style.top=(rect.bottom+window.scrollY+5)+"px";
      popup.style.display="block";
    });

    // Choose mood
    popup.querySelectorAll("button").forEach(btn=>{
      btn.addEventListener("click",()=>{
        if(!currentCell) return;
        const mood=btn.dataset.mood;
        currentCell.className="";
        currentCell.classList.add(mood);
        const grid=loadGrid();
        grid[`${currentCell.dataset.month}-${currentCell.dataset.day}`]=mood;
        saveGrid(grid);
        popup.style.display="none";
      });
    });

    // Hide popup if click outside
    document.addEventListener("click",(e)=>{
      if(!popup.contains(e.target) && e.target.tagName!=="TD"){
        popup.style.display="none";
      }
    });

    renderGrid();
  </script>
</body>
</html>
